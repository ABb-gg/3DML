<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Explorateur de Villes de Côte d'Ivoire</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet-routing-machine/3.2.12/leaflet-routing-machine.css" />
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        body {
            padding: 20px;
            /* Nouveau design de fond avec un dégradé élégant */
            background: linear-gradient(135deg, #e1f0e5 0%, #f5f7f7 50%, #fff1e3 100%);
            color: #333;
            background-attachment: fixed;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background-color: rgba(255, 255, 255, 0.95);
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.15);
            border: 1px solid rgba(255, 255, 255, 0.3);
            backdrop-filter: blur(5px);
        }
        h1 {
            color: #FF8C00;
            margin-bottom: 20px;
            text-align: center;
            font-size: 2.2em;
            text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.1);
            border-bottom: 3px solid #00843D;
            padding-bottom: 15px;
        }
        .flag-colors {
            height: 8px;
            display: flex;
            width: 200px;
            margin: -5px auto 20px;
            border-radius: 4px;
            overflow: hidden;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }
        .flag-orange {
            background-color: #FF8C00;
            width: 33.33%;
            height: 100%;
        }
        .flag-white {
            background-color: white;
            width: 33.33%;
            height: 100%;
        }
        .flag-green {
            background-color: #00843D;
            width: 33.33%;
            height: 100%;
        }
        .search-container {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        #location-search {
            flex-grow: 1;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            transition: all 0.3s ease;
        }
        #location-search:focus {
            border-color: #FF8C00;
            outline: none;
            box-shadow: 0 0 5px rgba(255, 140, 0, 0.3);
        }
        #search-button {
            padding: 12px 20px;
            background-color: #FF8C00;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }
        #search-button:hover {
            background-color: #E67300;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }
        .selection-container {
            margin-bottom: 20px;
        }
        #city-select {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        #city-select:focus {
            border-color: #00843D;
            outline: none;
            box-shadow: 0 0 5px rgba(0, 132, 61, 0.3);
        }
        #map {
            height: 550px;
            border-radius: 12px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.15);
            border: 3px solid #ddd;
        }
        .search-results {
            background: white;
            border: 2px solid #ddd;
            border-radius: 8px;
            max-height: 250px;
            overflow-y: auto;
            display: none;
            position: absolute;
            width: calc(100% - 140px);
            z-index: 1000;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        .search-result-item {
            padding: 12px 15px;
            cursor: pointer;
            border-bottom: 1px solid #eee;
            transition: all 0.2s ease;
        }
        .search-result-item:hover {
            background-color: #f5f9ff;
            padding-left: 20px;
        }
        #no-results {
            padding: 15px;
            color: #777;
            display: none;
            text-align: center;
            font-style: italic;
        }
        .section-title {
            font-size: 18px;
            color: #00843D;
            margin-bottom: 8px;
            font-weight: bold;
        }
        .info-panel {
            background-color: #f9f9f9;
            border-left: 4px solid #FF8C00;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 0 8px 8px 0;
        }
        footer {
            text-align: center;
            margin-top: 20px;
            color: #777;
            font-size: 14px;
        }
        .route-controls {
            margin-bottom: 20px;
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }
        .route-input {
            flex-grow: 1;
            min-width: 200px;
        }
        .route-input input {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
        }
        .route-input input:focus {
            border-color: #00843D;
            outline: none;
        }
        .route-buttons {
            display: flex;
            gap: 10px;
        }
        .route-button {
            padding: 12px 20px;
            background-color: #00843D;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
        }
        .route-button:hover {
            background-color: #006E32;
            transform: translateY(-2px);
        }
        .route-button.clear {
            background-color: #d9534f;
        }
        .route-button.clear:hover {
            background-color: #c9302c;
        }
        #route-panel {
            margin-top: 15px;
            display: none;
            background-color: #fff;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        #route-instructions {
            max-height: 300px;
            overflow-y: auto;
            margin-top: 10px;
        }
        #route-instructions ul {
            list-style-type: none;
            padding-left: 10px;
        }
        #route-instructions li {
            margin-bottom: 8px;
            padding-bottom: 8px;
            border-bottom: 1px dotted #eee;
        }
        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }
            .search-results {
                width: calc(100% - 100px);
            }
            .route-controls {
                flex-direction: column;
            }
        }
        .leaflet-routing-container {
            background-color: white;
            padding: 10px;
            border-radius: 8px;
            max-height: 300px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Explorateur de Villes de Côte d'Ivoire</h1>
        
        <div class="flag-colors">
            <div class="flag-orange"></div>
            <div class="flag-white"></div>
            <div class="flag-green"></div>
        </div>
        
        <div class="info-panel">
            <div class="section-title">Comment utiliser</div>
            <p>Recherchez directement une ville ou sélectionnez-en une dans la liste pour voir sa carte. Utilisez la fonction d'itinéraire pour planifier vos déplacements entre deux points.</p>
        </div>
        
        <!-- Recherche -->
        <div class="section-title">Recherche de ville</div>
        <div class="search-container">
            <input type="text" id="location-search" placeholder="Rechercher une ville...">
            <button id="search-button">Rechercher</button>
        </div>
        <div id="search-results" class="search-results">
            <div id="no-results">Aucune ville correspondante trouvée</div>
        </div>
        
        <!-- Sélection par liste déroulante -->
        <div class="section-title">Sélection par district</div>
        <div class="selection-container">
            <select id="city-select">
                <option value="">-- Sélectionnez une ville --</option>
                
                <!-- District d'Abidjan -->
                <optgroup label="District d'Abidjan">
                  <option value="Abobo,5.43081,-4.06229">Abobo</option>
                  <option value="Adjamé,5.36883,-4.01966">Adjamé</option>
                  <option value="Attécoubé,5.36546,-4.05270">Attécoubé</option>
                  <option value="Cocody,5.38215,-3.96512">Cocody</option>
                  <option value="Koumassi,5.29799,-3.93604">Koumassi</option>
                  <option value="Marcory,5.29443,-3.97855">Marcory</option>
                  <option value="Plateau,5.327982,-4.024393">Plateau</option>
                  <option value="Port-Bouët,5.26734,-3.92144">Port-Bouët</option>
                  <option value="Treichville,5.29369,-4.01263">Treichville</option>
                  <option value="Yopougon,5.3177,-4.0769">Yopougon</option>
                  <option value="Bingerville,5.3482,-3.8258">Bingerville</option>
                  <option value="Songon,5.3352,-4.2028">Songon</option>
                </optgroup>
                
                <!-- District des Lagunes -->
                <optgroup label="District des Lagunes">
                  <option value="Dabou,5.3238,-4.3722">Dabou</option>
                  <option value="Jacqueville,5.20763,-4.41951">Jacqueville</option>
                  <option value="Grand-Bassam,5.2544,-4.2469">Grand-Bassam</option>
                  <option value="Bonoua,5.27361,-3.59674">Bonoua</option>
                  <option value="Tiassalé,5.89565,-4.82506">Tiassalé</option>
                  <option value="Adiaké,5.2363,-3.2961">Adiaké</option>
                  <option value="Aboisso,5.7137,-3.0930">Aboisso</option>
                  <option value="Alépé,5.49664,-3.66381">Alépé</option>
                </optgroup>
                
                <!-- District de Yamoussoukro -->
                <optgroup label="District de Yamoussoukro">
                  <option value="Yamoussoukro,6.8200,-5.2776">Yamoussoukro</option>
                </optgroup>
                
                <!-- District des Montagnes -->
                <optgroup label="District des Montagnes">
                  <option value="Man,7.4103,-7.5504">Man</option>
                  <option value="Danané,7.2634,-8.1543">Danané</option>
                  <option value="Guiglo,6.4301,-7.5481">Guiglo</option>
                  <option value="Toulepleu,6.58090,-8.41502">Toulepleu</option>
                  <option value="Bangolo,7.01191,-7.48676">Bangolo</option>
                  <option value="Duékoué,7.05839,-7.52246">Duékoué</option>
                </optgroup>
                
                <!-- District du Sassandra-Marahoué -->
                <optgroup label="District du Sassandra-Marahoué">
                  <option value="Daloa,6.8870,-6.4530">Daloa</option>
                  <option value="Lakota,5.8511,-5.6828">Lakota</option>
                  <option value="Bouaflé,6.9802,-5.7458">Bouaflé</option>
                  <option value="Zuenoula,7.42802,-6.05003">Zuénoula</option>
                </optgroup>
                
                <!-- District de la Vallée du Bandama -->
                <optgroup label="District de la Vallée du Bandama">
                  <option value="Bouaké,7.6891,-5.0284">Bouaké</option>
                  <option value="Béoumi,7.67454,-5.58273">Béoumi</option>
                  <option value="Sakassou,7.45348,-5.29235">Sakassou</option>
                  <option value="Katiola,8.0903,-5.1660">Katiola</option>
                  <option value="Dabakala,8.36324,-4.42849">Dabakala</option>
                </optgroup>
                
                <!-- District de la Comoé -->
                <optgroup label="District de la Comoé">
                  <option value="Abengourou,6.7269,-3.4968">Abengourou</option>
                  <option value="Agnibilékrou,7.0649,-3.3624">Agnibilékrou</option>
                  <option value="Tanda,7.80367,-3.16725">Tanda</option>
                  <option value="Bondoukou,8.0745,-2.8017">Bondoukou</option>
                  <option value="Bouna,9.26872,-2.99898">Bouna</option>
                </optgroup>
                
                <!-- District du Woroba -->
                <optgroup label="District du Woroba">
                  <option value="Séguéla,7.96141,-6.67024">Séguéla</option>
                  <option value="Mankono,8.0461,-6.0510">Mankono</option>
                  <option value="Touba,8.28410,-7.68181">Touba</option>
                </optgroup>
                
                <!-- District des Savanes -->
                <optgroup label="District des Savanes">
                  <option value="Korhogo,9.4581,-5.6316">Korhogo</option>
                  <option value="Kong,9.14868,-4.61065">Kong</option>
                  <option value="Ferkessédougou,9.5936,-5.1982">Ferkessédougou</option>
                  <option value="Boundiali,9.52323,-6.48202">Boundiali</option>
                  <option value="Tengréla,10.4749,-6.4189">Tengréla</option>
                  <option value="Sinématiali,9.58408,-5.38403">Sinématiali</option>
                  <option value="Odiénné,9.50443,-7.56194">Odiénné</option>
                  <option value="Minignan,9.99648,-7.83669">Minignan</option>
                </optgroup>
                
                <!-- District du Gôh-Djiboua -->
                <optgroup label="District du Gôh-Djiboua">
                  <option value="Gagnoa,6.1335,-5.9511">Gagnoa</option>
                  <option value="Oumé,6.3818,-5.4180">Oumé</option>
                  <option value="Zouan-Hounien,6.91983,-8.20892">Zouan-Hounien</option>
                </optgroup>
                
                <!-- District du Lacs -->
                <optgroup label="District du Lacs">
                  <option value="Tiapoum,5.2578,-2.9114">Tiapoum</option>
                  <option value="Agboville,5.9308,-4.2131">Agboville</option>
                  <option value="Alépé,5.49661,-3.66389">Alépé</option>
                </optgroup>
                
                <!-- District du Bas-Sassandra -->
                <optgroup label="District du Bas-Sassandra">
                  <option value="San-Pédro,4.7590,-6.6464">San-Pédro</option>
                  <option value="Sassandra,5.3306,-6.3214">Sassandra</option>
                  <option value="Tabou,4.41628,-7.35592">Tabou</option>
                </optgroup>
            </select>
        </div>
        
        <!-- Contrôles d'itinéraire -->
        <div class="section-title">Planification d'itinéraire</div>
        <div class="route-controls">
            <div class="route-input">
                <input type="text" id="start-point" placeholder="Point de départ (cliquez sur la carte ou entrez une adresse)">
            </div>
            <div class="route-input">
                <input type="text" id="end-point" placeholder="Point d'arrivée (cliquez sur la carte ou entrez une adresse)">
            </div>
            <div class="route-buttons">
                <button id="calculate-route" class="route-button">Calculer l'itinéraire</button>
                <button id="clear-route" class="route-button clear">Effacer</button>
            </div>
        </div>
        
        <!-- Conteneur de carte -->
        <div class="section-title">Carte</div>
        <div id="map"></div>
        
        <footer>
            Explorateur de Villes de Côte d'Ivoire © 2025
        </footer>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet-routing-machine/3.2.12/leaflet-routing-machine.js"></script>
    <script>
        // Initialisation de la carte centrée sur la Côte d'Ivoire
        const map = L.map('map').setView([7.54, -5.54], 7);
        
        // Ajout des tuiles OpenStreetMap
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
        }).addTo(map);

        // Marqueur pour la ville sélectionnée
        let marker;
        
        // Variable pour stocker le contrôle d'itinéraire
        let routeControl = null;
        
        // Points de l'itinéraire
        let startPoint = null;
        let endPoint = null;
        let startMarker = null;
        let endMarker = null;
        
        // Extraction des données de toutes les villes pour la fonctionnalité de recherche
        const cityData = [];
        const citySelect = document.getElementById('city-select');
        const options = citySelect.querySelectorAll('option');
        
        options.forEach(option => {
            if (option.value && option.value !== "") {
                const [name, lat, lng] = option.value.split(',');
                cityData.push({
                    name: option.textContent,
                    district: option.parentNode.label,
                    value: option.value,
                    lat: parseFloat(lat),
                    lng: parseFloat(lng)
                });
            }
        });
        
        // Fonction pour mettre à jour la carte
        function updateMap(cityValue) {
            if (!cityValue) return;
            
            const [cityName, lat, lng] = cityValue.split(',');
            const latNum = parseFloat(lat);
            const lngNum = parseFloat(lng);
            
            // Mise à jour de la vue de la carte
            map.setView([latNum, lngNum], 13);
            
            // Suppression du marqueur existant, s'il y en a un
            if (marker) {
                map.removeLayer(marker);
            }
            
            // Ajout d'un nouveau marqueur
            const customIcon = L.icon({
                iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-orange.png',
                shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-shadow.png',
                iconSize: [25, 41],
                iconAnchor: [12, 41],
                popupAnchor: [1, -34],
                shadowSize: [41, 41]
            });
            
            marker = L.marker([latNum, lngNum], {icon: customIcon}).addTo(map)
                .bindPopup(`<div style="font-weight:bold;font-size:16px;color:#FF8C00;">${cityName}</div>
                <button onclick="setAsStart('${cityName}', ${latNum}, ${lngNum})" style="margin-top:5px;padding:3px 6px;background:#00843D;color:white;border:none;border-radius:4px;cursor:pointer;margin-right:5px;">Point de départ</button>
                <button onclick="setAsEnd('${cityName}', ${latNum}, ${lngNum})" style="margin-top:5px;padding:3px 6px;background:#FF8C00;color:white;border:none;border-radius:4px;cursor:pointer;">Point d'arrivée</button>`).openPopup();
        }
        
        // Fonction pour définir un point comme point de départ
        window.setAsStart = function(name, lat, lng) {
            document.getElementById('start-point').value = name;
            startPoint = [lat, lng];
            
            // Ajout d'un marqueur pour le point de départ
            if (startMarker) {
                map.removeLayer(startMarker);
            }
            
            const startIcon = L.icon({
                iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-green.png',
                shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-shadow.png',
                iconSize: [25, 41],
                iconAnchor: [12, 41],
                popupAnchor: [1, -34],
                shadowSize: [41, 41]
            });
            
            startMarker = L.marker([lat, lng], {icon: startIcon}).addTo(map)
                .bindPopup(`<div style="font-weight:bold;color:#00843D;">Point de départ: ${name}</div>`);
            
            // Calculer l'itinéraire si les deux points sont définis
            if (startPoint && endPoint) {
                calculateRoute();
            }
        };
        
        // Fonction pour définir un point comme point d'arrivée
        window.setAsEnd = function(name, lat, lng) {
            document.getElementById('end-point').value = name;
            endPoint = [lat, lng];
            
            // Ajout d'un marqueur pour le point d'arrivée
            if (endMarker) {
                map.removeLayer(endMarker);
            }
            
            const endIcon = L.icon({
                iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-red.png',
                shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-shadow.png',
                iconSize: [25, 41],
                iconAnchor: [12, 41],
                popupAnchor: [1, -34],
                shadowSize: [41, 41]
            });
            
            endMarker = L.marker([lat, lng], {icon: endIcon}).addTo(map)
                .bindPopup(`<div style="font-weight:bold;color:#d9534f;">Point d'arrivée: ${name}</div>`);
            
            // Calculer l'itinéraire si les deux points sont définis
            if (startPoint && endPoint) {
                calculateRoute();
            }
        };
        
        // Fonction pour calculer l'itinéraire
        function calculateRoute() {
            if (!startPoint || !endPoint) {
                alert("Veuillez sélectionner un point de départ et un point d'arrivée.");
                return;
            }
            
            // Supprimer l'itinéraire existant s'il y en a un
            if (routeControl) {
                map.removeControl(routeControl);
            }
            
            // Créer un nouvel itinéraire
            routeControl = L.Routing.control({
                waypoints: [
                    L.latLng(startPoint[0], startPoint[1]),
                    L.latLng(endPoint[0], endPoint[1])
                ],
                routeWhileDragging: true,
                lineOptions: {
                    styles: [
                        {color: '#FF8C00', opacity: 0.8, weight: 5}
                    ]
                },
                createMarker: function() { return null; }, // Ne pas créer de marqueurs supplémentaires
                addWaypoints: false,
                draggableWaypoints: false,
                language: 'fr',
                show: false // Ne pas afficher le panneau d'instructions par défaut
            }).addTo(map);
            
            // Ajuster la vue pour afficher tout l'itinéraire
            routeControl.on('routesfound', function(e) {
                const routes = e.routes;
                const summary = routes[0].summary;
                
                // Créer une popup avec les informations sur l'itinéraire
                let distanceInKm = (summary.totalDistance / 1000).toFixed(1);
                let timeInHours = Math.floor(summary.totalTime / 3600);
                let timeInMinutes = Math.floor((summary.totalTime % 3600) / 60);
                
                let popupContent = `
                    <div style="text-align:center;font-weight:bold;margin-bottom:5px;">Informations sur l'itinéraire</div>
                    <div>Distance: ${distanceInKm} km</div>
                    <div>Durée estimée: ${timeInHours}h ${timeInMinutes}min</div>
                `;
                
                L.popup()
                    .setLatLng([(startPoint[0] + endPoint[0]) / 2, (startPoint[1] + endPoint[1]) / 2])
                    .setContent(popupContent)
                    .openOn(map);
                
                // Ajuster la vue pour montrer tout l'itinéraire
                const bounds = L.latLngBounds(startPoint, endPoint);
                map.fitBounds(bounds, {padding: [50, 50]});
            });
        }
        
        // Écouteur d'événements pour le changement de liste déroulante
        citySelect.addEventListener('change', function() {
            updateMap(this.value);
        });
        
        // Fonctionnalité de recherche
        const searchInput = document.getElementById('location-search');
        const searchButton = document.getElementById('search-button');
        const searchResults = document.getElementById('search-results');
        const noResultsMessage = document.getElementById('no-results');
        
        // Fonction pour effectuer la recherche
        function performSearch() {
            const query = searchInput.value.trim().toLowerCase();
            if (!query) {
                searchResults.style.display = 'none';
                return;
            }
            
            // Filtrage des villes en fonction de la requête de recherche
            const matchingCities = cityData.filter(city => 
                city.name.toLowerCase().includes(query) || 
                city.district.toLowerCase().includes(query)
            );
            
            // Affichage des résultats de recherche
            searchResults.innerHTML = '';
            if (matchingCities.length === 0) {
                noResultsMessage.style.display = 'block';searchResults.appendChild(noResultsMessage);
            searchResults.style.display = 'block';
        } else {
            noResultsMessage.style.display = 'none';
            
            matchingCities.forEach(city => {
                const resultItem = document.createElement('div');
                resultItem.className = 'search-result-item';
                resultItem.textContent = `${city.name} (${city.district})`;
                resultItem.addEventListener('click', function() {
                    updateMap(city.value);
                    searchInput.value = city.name;
                    searchResults.style.display = 'none';
                    
                    // Mise à jour de la liste déroulante pour correspondre à la ville sélectionnée
                    citySelect.value = city.value;
                });
                searchResults.appendChild(resultItem);
            });
            
            searchResults.style.display = 'block';
        }
    }
    
    // Écouteurs d'événements pour la recherche
    searchButton.addEventListener('click', performSearch);
    searchInput.addEventListener('keyup', function(event) {
        if (event.key === 'Enter') {
            performSearch();
        } else if (searchInput.value.trim().length >= 2) {
            performSearch();
        } else {
            searchResults.style.display = 'none';
        }
    });
    
    // Masquer les résultats de recherche lors du clic en dehors
    document.addEventListener('click', function(event) {
        if (!searchResults.contains(event.target) && event.target !== searchInput && event.target !== searchButton) {
            searchResults.style.display = 'none';
        }
    });
    
    // Écouteurs d'événements pour le calcul d'itinéraire
    document.getElementById('calculate-route').addEventListener('click', calculateRoute);
    document.getElementById('clear-route').addEventListener('click', function() {
        // Supprimer l'itinéraire existant s'il y en a un
        if (routeControl) {
            map.removeControl(routeControl);
            routeControl = null;
        }
        
        // Supprimer les marqueurs de départ et d'arrivée
        if (startMarker) {
            map.removeLayer(startMarker);
            startMarker = null;
        }
        
        if (endMarker) {
            map.removeLayer(endMarker);
            endMarker = null;
        }
        
        // Réinitialiser les champs d'entrée
        document.getElementById('start-point').value = '';
        document.getElementById('end-point').value = '';
        startPoint = null;
        endPoint = null;
    });
    
    // Ajouter un écouteur d'événements sur la carte pour permettre à l'utilisateur de sélectionner des points
    map.on('click', function(e) {
        // Si aucun champ n'est actuellement focalisé, ne rien faire
        const startInput = document.getElementById('start-point');
        const endInput = document.getElementById('end-point');
        
        if (document.activeElement !== startInput && document.activeElement !== endInput) {
            return;
        }
        
        const lat = e.latlng.lat;
        const lng = e.latlng.lng;
        
        // Chercher la ville la plus proche (simplification)
        let closestCity = null;
        let minDistance = Infinity;
        
        cityData.forEach(city => {
            const distance = Math.sqrt(
                Math.pow(city.lat - lat, 2) + 
                Math.pow(city.lng - lng, 2)
            );
            
            if (distance < minDistance) {
                minDistance = distance;
                closestCity = city;
            }
        });
        
        // Si une ville est trouvée
        if (closestCity) {
            // Si le champ de départ est focalisé
            if (document.activeElement === startInput) {
                setAsStart(closestCity.name, closestCity.lat, closestCity.lng);
            } 
            // Si le champ d'arrivée est focalisé
            else if (document.activeElement === endInput) {
                setAsEnd(closestCity.name, closestCity.lat, closestCity.lng);
            }
        }
    });
    
    // Initialiser la carte avec une ville par défaut (Yamoussoukro - capitale politique)
    updateMap('Yamoussoukro,6.8200,-5.2776');
    citySelect.value = 'Yamoussoukro,6.8200,-5.2776';
    
    // Ajouter une couche pour les informations sur les villes importantes
    const importantCities = [
        {name: "Abidjan", description: "Capitale économique et plus grande ville", lat: 5.35976, lng: -4.00838},
        {name: "Yamoussoukro", description: "Capitale politique", lat: 6.8200, lng: -5.2776},
        {name: "Bouaké", description: "Deuxième plus grande ville", lat: 7.6891, lng: -5.0284},
        {name: "Korhogo", description: "Principale ville du nord", lat: 9.4581, lng: -5.6316},
        {name: "San-Pédro", description: "Deuxième port du pays", lat: 4.7590, lng: -6.6464}
    ];
    
    // Ajouter des marqueurs pour ces villes importantes avec un style différent
    importantCities.forEach(city => {
        const icon = L.divIcon({
            className: 'important-city-marker',
            html: `<div style="background-color: rgba(0, 132, 61, 0.7); color: white; padding: 5px; border-radius: 5px; font-weight: bold; font-size: 12px; text-align: center;">${city.name}</div>`,
            iconSize: [100, 30],
            iconAnchor: [50, 15]
        });
        
        L.marker([city.lat, city.lng], {icon: icon}).addTo(map)
            .bindPopup(`<div style="font-weight:bold;color:#00843D;">${city.name}</div><div>${city.description}</div>`);
    });
    
    // Ajouter un contrôle d'échelle à la carte
    L.control.scale({imperial: false, metric: true}).addTo(map);
    
    // Fonction pour ajouter une bordure autour de la Côte d'Ivoire
    // Note: Ceci est une simplification, les coordonnées réelles seraient plus précises
    const ivoryCoastBorder = [
        [10.740, -8.140], // Nord-ouest
        [10.740, -2.494], // Nord-est
        [4.352, -2.510], // Sud-est
        [4.340, -7.540], // Sud-ouest
        [10.740, -8.140]  // Refermer la frontière
    ];
    
    L.polyline(ivoryCoastBorder, {
        color: '#00843D',
        weight: 3,
        opacity: 0.7,
        dashArray: '5, 10'
    }).addTo(map);
    
    // Ajouter la légende
    const legend = L.control({position: 'bottomright'});
    legend.onAdd = function() {
        const div = L.DomUtil.create('div', 'info legend');
        div.style.padding = '10px';
        div.style.background = 'white';
        div.style.borderRadius = '8px';
        div.style.boxShadow = '0 0 15px rgba(0,0,0,0.2)';
        div.style.border = '1px solid #ddd';
        div.style.fontSize = '14px';
        
        div.innerHTML = `
            <div style="font-weight:bold;margin-bottom:8px;color:#00843D;">Légende</div>
            <div style="margin-bottom:5px;"><span style="display:inline-block;width:12px;height:12px;background-color:#FF8C00;border-radius:50%;margin-right:5px;"></span> Ville sélectionnée</div>
            <div style="margin-bottom:5px;"><span style="display:inline-block;width:12px;height:12px;background-color:#00843D;border-radius:50%;margin-right:5px;"></span> Point de départ</div>
            <div style="margin-bottom:5px;"><span style="display:inline-block;width:12px;height:12px;background-color:#d9534f;border-radius:50%;margin-right:5px;"></span> Point d'arrivée</div>
            <div><span style="display:inline-block;width:12px;height:3px;background-color:#FF8C00;margin-right:5px;"></span> Itinéraire</div>
        `;
        
        return div;
    };
    legend.addTo(map);
</script>
</body>
</html> 